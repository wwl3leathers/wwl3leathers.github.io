<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout – 3Leathers</title>
  <meta name="description" content="Review your handmade leather order from 3Leathers and pay securely.">
  <style>
    /* Match site palette (from index.html) */
    :root{ --bg:#0b0b0b; --ink:#f8f5e3; --accent:#d6b14a; --muted:rgba(255,255,255,.08); }
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--accent);text-decoration:none}

    /* Header/nav identical to index */
    header{position:sticky;top:0;z-index:10;background:rgba(0,0,0,.6);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--muted)}
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:40px;border-radius:4px}
    nav a{margin-left:10px}
    .contact-info{margin-left:auto;font-size:.9rem;color:var(--ink);white-space:nowrap}
    @media (max-width:700px){ .contact-info{display:block;margin-left:0;margin-top:4px;text-align:right} }

    /* Page layout */
    .container{max-width:960px;margin:0 auto;padding:clamp(16px,3vw,32px)}
    .card{background:rgba(0,0,0,.55);border:1px solid var(--muted);border-radius:14px;overflow:hidden;margin-bottom:18px}
    .pad{padding:18px}
    .title{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0 0 6px}
    .muted{color:#cfc8a8}
    .small{font-size:.9rem}
    .pill{padding:12px 16px;border-radius:999px;background:var(--accent);color:#000;font-weight:700;border:1px solid #e3d9b2;cursor:pointer}
    .pill.secondary{background:#2a2a2a;color:var(--ink);border:1px solid var(--muted)}
    .btns{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .line{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;border-top:1px solid var(--muted);padding:12px 0}
    .left{display:flex;gap:12px;align-items:flex-start}
    .thumb{width:110px;height:82px;flex:0 0 110px;border:1px solid var(--muted);border-radius:10px;overflow:hidden;background:#111}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta h3{margin:0 0 6px 0}
    .opt{margin:0 0 4px 0}
    .qtybox{display:flex;gap:8px;align-items:center}
    .qtybox input{width:72px;background:#0f0f0f;border:1px solid #2a2a2a;color:var(--ink);padding:8px;border-radius:8px}
    .price{white-space:nowrap}
    .right{text-align:right}

    .totals{display:flex;justify-content:flex-end;padding:12px 0;border-top:1px solid var(--muted);margin-top:6px}
    .totals table{border-collapse:collapse}
    .totals td{padding:6px 0 6px 24px}
    .totals .num{text-align:right;min-width:120px}

    .center{text-align:center}
    .empty{padding:40px 18px}
    .icons{opacity:.9;font-size:.9rem}
  </style>
</head>
<body>
  <!-- Site header -->
  <header>
    <div class="wrap row">
      <div class="brand">
        <img src="images/Logo-min.jpg" alt="3Leathers logo">
        <strong>3Leathers</strong>
      </div>
      <span class="contact-info">(304) 669-1412 • Bridgeport, WV</span>
      <nav>
        <a href="index.html"><strong>Home</strong></a> •
        <a href="shop.html">Shop</a> •
        <a href="custom.html">Custom</a> •
        <a href="checkout.html">Checkout</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="pad">
        <h1 class="title"><span>Checkout</span></h1>
        <p class="small muted">Review your order below. You can update quantities or remove items before paying.</p>
      </div>
    </section>

    <!-- Cart items -->
    <section class="card" id="cartCard">
      <div class="pad" id="cartBody">
        <!-- JS will render items here -->
      </div>
    </section>

    <!-- Totals + actions -->
    <section class="card">
      <div class="pad">
        <div class="totals" id="totalsWrap">
          <!-- JS totals -->
        </div>

        <div class="btns">
          <a class="pill secondary" href="shop.html">Back to Shop</a>
          <!-- Generic pay button; swap href for Square later -->
          <a id="payBtn" class="pill" href="#">
            Pay Securely
          </a>
          <span class="icons muted small">We accept all major credit cards.</span>
          <button class="pill secondary" type="button" onclick="clearOrder()">Clear Order</button>
        </div>

        <div class="small muted" style="margin-top:14px">
          <p><strong>Production Time:</strong> Most orders ship in about <strong>1 week</strong>. If leather gets stubborn, I’ll email you with an update.</p>
          <p><strong>Non-Refundable Deposits & Payments:</strong> Leather can’t be “unstained,” “unstamped,” or “un-stitched.” Once we begin, <strong>all payments and deposits are non-refundable</strong>.</p>
        </div>
      </div>
    </section>
  </main>

  <script>
    const CART_KEY = 'cart';

    function getCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); }

    function money(n){ return '$' + (Math.round(n * 100) / 100).toFixed(2); }

    function lineTotal(item){ return Number(item.unitPrice || 0) * Number(item.quantity || 1); }

    function renderCart(){
      const body = document.getElementById('cartBody');
      const totalsWrap = document.getElementById('totalsWrap');
      const cart = getCart();

      if(!cart.length){
        body.innerHTML = `
          <div class="empty center">
            <p class="muted">Your order is empty.</p>
            <p><a class="pill" href="shop.html">Browse the Shop</a></p>
          </div>`;
        totalsWrap.innerHTML = '';
        return;
      }

      // Items
      body.innerHTML = cart.map((item, idx) => {
        const opts = (item.options || []).map(o => `<div class="opt small muted">+ ${o.name} (${money(o.price)})</div>`).join('') || '<div class="opt small muted">No customizations</div>';
        const notes = item.notes ? `<div class="small muted">Notes: ${escapeHtml(item.notes)}</div>` : '';
        const link = item.link ? `<div class="small"><a href="${escapeAttr(item.link)}" target="_blank" rel="noopener">Reference link</a></div>` : '';
        const unit = Number(item.unitPrice || 0);

        return `
          <div class="line">
            <div class="left">
              <div class="thumb">${item.image ? `<img src="${escapeAttr(item.image)}" alt="Item image">` : ''}</div>
              <div class="meta">
                <h3>${escapeHtml(item.category || 'Item')}${item.variant ? ` — ${escapeHtml(item.variant)}` : ''}</h3>
                <div class="small muted">Unit: ${money(unit)}</div>
                ${opts}
                ${notes}
                ${link}
              </div>
            </div>

            <div class="right">
              <div class="qtybox">
                <label class="small muted">Qty</label>
                <input type="number" min="1" value="${Number(item.quantity||1)}" onchange="updateQty(${idx}, this.value)">
                <button class="pill secondary" type="button" onclick="removeItem(${idx})">Remove</button>
              </div>
              <div class="price small" style="margin-top:8px"><strong>${money(lineTotal(item))}</strong></div>
            </div>
          </div>
        `;
      }).join('');

      // Totals
      const subtotal = cart.reduce((s, it) => s + lineTotal(it), 0);
      totalsWrap.innerHTML = `
        <table>
          <tr><td class="small muted">Subtotal</td><td class="num"><strong>${money(subtotal)}</strong></td></tr>
          <tr><td class="small muted">Shipping</td><td class="num small muted">Calculated later</td></tr>
          <tr><td class="small muted">Tax</td><td class="num small muted">None (for now)</td></tr>
        </table>
      `;
    }

    function updateQty(index, val){
      const qty = Math.max(1, Number(val||1));
      const cart = getCart();
      if(cart[index]){
        cart[index].quantity = qty;
        setCart(cart);
        renderCart();
      }
    }

    function removeItem(index){
      const cart = getCart();
      cart.splice(index, 1);
      setCart(cart);
      renderCart();
    }

    function clearOrder(){
      if(confirm('Clear your entire order?')){
        setCart([]);
        renderCart();
      }
    }

    // Simple HTML escape for notes display
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function escapeAttr(s){ return String(s).replace(/"/g, '&quot;'); }

    // TODO: When Square is ready, set your real payment link here:
    // document.getElementById('payBtn').href = 'https://square.link/u/your-payment-link';
    // Or replace the button entirely with Square’s embedded checkout.

    renderCart();
  </script>
</body>
</html>
