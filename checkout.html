<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout – 3Leathers</title>
  <meta name="description" content="Review your 3Leathers order, add shipping, and pay securely.">
  <style>
    :root{ --bg:#0b0b0b; --ink:#f8f5e3; --accent:#d6b14a; --muted:rgba(255,255,255,.08); }
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--accent);text-decoration:none}

    /* Header/nav */
    header{position:sticky;top:0;z-index:10;background:rgba(0,0,0,.6);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--muted)}
    .wrap{max-width:1100px;margin:auto;padding:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:40px;border-radius:4px}
    nav a{margin-left:10px}
    .contact-info{margin-left:auto;font-size:.9rem;color:var(--ink);white-space:nowrap}
    @media (max-width:700px){ .contact-info{display:block;margin-left:0;margin-top:4px;text-align:right;white-space: normal;
                                           } 
                            }

    /* Page layout */
    .container{max-width:960px;margin:0 auto;padding:clamp(16px,3vw,32px)}
    .card{background:rgba(0,0,0,.55);border:1px solid var(--muted);border-radius:14px;overflow:hidden;margin-bottom:18px}
    .pad{padding:18px}
    .title{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0 0 6px}
    .muted{color:#cfc8a8}
    .small{font-size:.9rem}
    .pill{padding:12px 16px;border-radius:999px;background:var(--accent);color:#000;font-weight:700;border:1px solid #e3d9b2;cursor:pointer}
    .pill.secondary{background:#2a2a2a;color:var(--ink);border:1px solid var(--muted)}
    .btns{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .line{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;border-top:1px solid var(--muted);padding:12px 0}
    .left{display:flex;gap:12px;align-items:flex-start}
    .thumb{width:110px;height:82px;flex:0 0 110px;border:1px solid var(--muted);border-radius:10px;overflow:hidden;background:#111}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta h3{margin:0 0 6px 0}
    .opt{margin:0 0 4px 0}
    ..qtybox{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}
    .qtybox input{width:72px;background:#0f0f0f;border:1px solid #2a2a2a;color:var(--ink);padding:8px;border-radius:8px}
    .price{white-space:nowrap}
    .right{text-align:right}

    .totals{display:flex;justify-content:flex-end;padding:12px 0;border-top:1px solid var(--muted);margin-top:6px}
    .totals table{border-collapse:collapse}
    .totals td{padding:6px 0 6px 24px}
    .totals .num{text-align:right;min-width:120px}

    .center{text-align:center}
    .empty{padding:40px 18px}

    /* Shipping form */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){ .grid{grid-template-columns:1fr} }
    input, textarea{
      width:100%;background:#0f0f0f;border:1px solid #2a2a2a;color:var(--ink);
      padding:12px;border-radius:12px
    }
    textarea{min-height:110px;resize:vertical}
    label{display:block}
    .hint{font-size:.85rem;color:#cfc8a8;margin-top:6px}

    .icons-link{display:block;margin-top:8px}
    .icons-link img{max-width:320px;width:100%;height:auto;display:block;border-radius:10px;border:1px solid var(--muted);background:#111}
  </style>
</head>
<body>
  <!-- Site header -->
  <header>
    <div class="wrap row">
      <div class="brand">
        <img src="images/Logo-min.jpg" alt="3Leathers logo">
        <strong>3Leathers</strong>
      </div>
      <span class="contact-info">(304) 669-1412 • Bridgeport, WV</span>
      <nav>
        <a href="index.html"><strong>Home</strong></a> •
        <a href="shop.html">Shop</a> •
        <a href="custom.html">Custom</a> •
        <a href="checkout.html">Checkout</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="pad">
        <h1 class="title"><span>Checkout</span></h1>
        <p class="small muted">Review your order below. You can update quantities or remove items before paying.</p>
        <p class="small muted" style="font-weight:600; margin-top:6px;">
          Your order will be clamped under a piece of tooling leather, so it doesn’t wander off.<br>
          I’ll take a sip of coffee, brush off the leather shavings, and give your idea a look.<br>
          If you don’t hear from me soon, assume I’m elbow-deep in dye — not ignoring you.
        </p>

        <!-- ADDED: Simple explanation of how this checkout works -->
        <div class="small muted" style="margin-top:10px;">
          <h2 style="margin:0 0 6px 0;font-size:1rem;">How this checkout works</h2>
          <p style="margin:0 0 4px 0;">
            This is not an instant “pay now” button. When you click <strong>Send invoice to 3Leathers</strong>,
            it builds an email with your cart and shipping info and sends it to me.
          </p>
          <ul style="margin:4px 0 0 18px;padding:0;">
            <li>Fill in your contact and shipping details below.</li>
            <li>Review the items in your cart — adjust quantities or use the <strong>Remove</strong> button for anything you don’t want.</li>
            <li>Click <strong>Send invoice to 3Leathers</strong> and send the email that pops up.</li>
            <li>I’ll reply with a Square invoice and final total, then start your order once it’s paid.</li>
          </ul>
        </div>
        <!-- END ADDED -->
      </div>
    </section>

    <!-- Cart items -->
    <section class="card" id="cartCard">
      <div class="pad" id="cartBody">
        <!-- JS will render items here -->
      </div>
    </section>

    <!-- Shipping & Contact -->
    <section class="card" id="shippingCard">
      <div class="pad">
        <h2 class="title"><span>Shipping & Contact</span></h2>
        <div class="grid">
          <label>Full Name<br><input id="ship-name" type="text" autocomplete="name" required></label>
          <label>Email<br><input id="ship-email" type="email" autocomplete="email" required></label>
          <label>Phone<br><input id="ship-phone" type="tel" autocomplete="tel"></label>
          <label>Address Line 1<br><input id="ship-addr1" type="text" autocomplete="address-line1" required></label>
          <label>Address Line 2 (optional)<br><input id="ship-addr2" type="text" autocomplete="address-line2"></label>
          <label>City<br><input id="ship-city" type="text" autocomplete="address-level2" required></label>
          <label>State<br><input id="ship-state" type="text" autocomplete="address-level1" required></label>
          <label>ZIP<br><input id="ship-zip" type="text" autocomplete="postal-code" required></label>
        </div>
        <label style="display:block;margin-top:10px">Delivery Instructions (optional)
          <textarea id="ship-notes" class="small" placeholder="Gate code, safe drop spot, special handling, favorite coffee…"></textarea>
        </label>
        <p class="hint">We’ll use this to ship your order and to confirm details if needed.</p>
      </div>
    </section>

    <!-- Totals + actions -->
    <section class="card">
      <div class="pad">
        <div class="totals" id="totalsWrap"><!-- JS totals --></div>

        <div class="btns">
          <a class="pill secondary" href="shop.html">Back to Shop</a>
          <a id="payBtn" class="pill" href="#">Send invoice to 3Leathers</a>

          <!-- ADDED: Small note directly under the button -->
          <p class="small muted" style="font-style:italic;margin:4px 0 0 0;">
            This doesn’t charge your card — it sends your request to Walter so he can review it and email your invoice.
          </p>
          <!-- END ADDED -->

          <!-- Payment icons section -->
<div style="text-align:center; margin-top:12px;">
  <a href="https://square.link/u/vrAPnrrI" target="_blank" rel="noopener">
    <img src="images/payment-icons.jpeg" alt="Accepted Payment Methods" 
         style="max-width:240px; width:90%; border-radius:8px; opacity:0.9%;">
  </a>
  <p style="color:#d6b14a; font-size:0.9rem; margin-top:6px;">
    “Yes, I take plastic, magic, and Square—just not Monopoly money.”
  </p>
</div>

          <span class="small muted">We accept all major credit cards.</span>
        </div>

        <!-- Clickable payment icons just under the button -->
        <a class="icons-link" href="images/payment-icons.jpeg" target="_blank" rel="noopener">
          <img src="images/payment-icons.jpeg" alt="Accepted payments: major credit cards">
        </a>

        <div class="small muted" style="margin-top:14px">
          <p><strong>Production Time:</strong> Most orders ship in about <strong>1 week</strong>. If leather gets stubborn, I’ll email you.</p>
          <p><strong>Non-Refundable Deposits & Payments:</strong> Leather can’t be “unstained,” “unstamped,” or “un-stitched.” Once we begin, <strong>all payments and deposits are non-refundable</strong>.</p>
        </div>
      </div>
    </section>
  </main>

  <script>
    const CART_KEY = 'cart';
    const SQUARE_LINK = 'https://square.link/u/YOUR_SQUARE_LINK_HERE'; // TODO: paste your real Square link

    function getCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); }
    function money(n){ return '$' + (Math.round(n * 100) / 100).toFixed(2); }
    function lineTotal(item){ return Number(item.unitPrice || 0) * Number(item.quantity || 1); }

    function renderCart(){
      const body = document.getElementById('cartBody');
      const totalsWrap = document.getElementById('totalsWrap');
      const cart = getCart();

      if(!cart.length){
        body.innerHTML = `
          <div class="empty center">
            <p class="muted">Your order is empty.</p>
            <p><a class="pill" href="shop.html">Browse the Shop</a></p>
          </div>`;
        totalsWrap.innerHTML = '';
        return;
      }

      body.innerHTML = cart.map((item, idx) => {
        const opts = (item.options || []).map(o => `<div class="opt small muted">+ ${o.name} (${money(o.price)})</div>`).join('') || '<div class="opt small muted">No customizations</div>';
        const notes = item.notes ? `<div class="small muted">Notes: ${escapeHtml(item.notes)}</div>` : '';
        const link = item.link ? `<div class="small"><a href="${escapeAttr(item.link)}" target="_blank" rel="noopener">Reference link</a></div>` : '';
        const unit = Number(item.unitPrice || 0);

        return `
          <div class="line">
            <div class="left">
              <div class="thumb">${item.image ? `<img src="${escapeAttr(item.image)}" alt="Item image">` : ''}</div>
              <div class="meta">
                <h3>${escapeHtml(item.category || 'Item')}${item.variant ? ` — ${escapeHtml(item.variant)}` : ''}</h3>
                <div class="small muted">Unit: ${money(unit)}</div>
                ${opts}
                ${notes}
                ${link}
              </div>
            </div>

            <div class="right">
              <div class="qtybox">
                <label class="small muted">Qty</label>
                <input type="number" min="1" value="${Number(item.quantity||1)}" onchange="updateQty(${idx}, this.value)">
                <button class="pill secondary" type="button" onclick="removeItem(${idx})">Remove</button>
              </div>
              <div class="price small" style="margin-top:8px"><strong>${money(lineTotal(item))}</strong></div>
            </div>
          </div>
        `;
      }).join('');

      const subtotal = cart.reduce((s, it) => s + lineTotal(it), 0);
      totalsWrap.innerHTML = `
        <table>
          <tr><td class="small muted">Subtotal</td><td class="num"><strong>${money(subtotal)}</strong></td></tr>
          <tr><td class="small muted">Shipping</td><td class="num small muted">Calculated at payment</td></tr>
          <tr><td class="small muted">Tax</td><td class="num small muted">None (for now)</td></tr>
        </table>
      `;
    }

    function updateQty(index, val){
      const qty = Math.max(1, Number(val||1));
      const cart = getCart();
      if(cart[index]){
        cart[index].quantity = qty;
        setCart(cart);
        renderCart();
      }
    }

    function removeItem(index){
      const cart = getCart();
      cart.splice(index, 1);
      setCart(cart);
      renderCart();
    }

    // Save shipping locally (so you can view/recover if needed)
    function getShipping() {
      return {
        name:  document.getElementById('ship-name')?.value.trim(),
        email: document.getElementById('ship-email')?.value.trim(),
        phone: document.getElementById('ship-phone')?.value.trim(),
        addr1: document.getElementById('ship-addr1')?.value.trim(),
        addr2: document.getElementById('ship-addr2')?.value.trim(),
        city:  document.getElementById('ship-city')?.value.trim(),
        state: document.getElementById('ship-state')?.value.trim(),
        zip:   document.getElementById('ship-zip')?.value.trim(),
        notes: document.getElementById('ship-notes')?.value.trim(),
      };
    }

    function validateShipping(s) {
      return !!(s.name && s.email && s.addr1 && s.city && s.state && s.zip);
    }

    (function initPay(){
      const btn = document.getElementById('payBtn');
      if(!btn) return;
      btn.addEventListener('click', (e) => {
        e.preventDefault();

        const cart = getCart();
        if(!cart.length){ alert('Your order is empty.'); return; }

        const ship = getShipping();
        if(!validateShipping(ship)){
          alert('Please fill in Name, Email, Address, City, State, and ZIP.');
          return;
        }

              // Save a lightweight snapshot locally (for your records if needed)
        try { localStorage.setItem('shipping', JSON.stringify(ship)); } catch {}

        // Build plain-text order summary for Walter's email
        const subtotal = cart.reduce((sum, it) => sum + lineTotal(it), 0);
        const lines = [];

        lines.push('New 3Leathers order request');
        lines.push('');
        lines.push('Customer info:');
        lines.push(`Name: ${ship.name}`);
        lines.push(`Email: ${ship.email}`);
        if (ship.phone) lines.push(`Phone: ${ship.phone}`);
        lines.push(`Address: ${ship.addr1}`);
        if (ship.addr2) lines.push(`Address 2: ${ship.addr2}`);
        lines.push(`City/State/ZIP: ${ship.city}, ${ship.state} ${ship.zip}`);
        lines.push('');

        if (ship.notes) {
          lines.push('Delivery instructions:');
          lines.push(ship.notes);
          lines.push('');
        }

        lines.push('Items:');

        cart.forEach((item, idx) => {
          lines.push('');
          lines.push(`Item ${idx + 1}: ${item.category} – ${item.variant}`);
          lines.push(`  Quantity: ${item.quantity}`);
          lines.push(`  Unit price: ${money(item.unitPrice || 0)}`);

          const opts = Array.isArray(item.options) ? item.options : [];
          if (opts.length) {
            lines.push('  Options:');
            opts.forEach(o => {
              const price = typeof o.price === 'number' ? money(o.price) : String(o.price);
              lines.push(`    - ${o.label}: ${price}`);
            });
          } else {
            lines.push('  Options: none');
          }

          if (item.notes) {
            lines.push(`  Notes: ${item.notes}`);
          }
          if (item.link) {
            lines.push(`  Reference link: ${item.link}`);
          }

          lines.push(`  Line total: ${money(lineTotal(item))}`);
        });

        lines.push('');
        lines.push(`Subtotal (before shipping/tax): ${money(subtotal)}`);
        lines.push('');
        lines.push('Shipping and any tax will be added to the Square invoice.');

        const subject = encodeURIComponent('3Leathers Order Request');
        const body = encodeURIComponent(lines.join('\n'));

        const mailto = `mailto:wwl3leathers@outlook.com?subject=${subject}&body=${body}`;
        window.location.href = mailto;

      });
    })();

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function escapeAttr(s){ return String(s).replace(/"/g, '&quot;'); }

    renderCart();
  </script>
</body>
</html>
